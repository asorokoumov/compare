<!DOCTYPE html>
<head>
    <meta charset="UTF-8">
    {% load staticfiles %}
    <title>Index page</title>
</head>
<body>

<form class="form-horizontal">


<!-- Select Basic -->
<div class="form-group">
  <label class="col-md-4 control-label" for="brand"></label>
  <div class="col-md-4">
    <select id="brand" name="brand" class="form-control">
      <option value="-1">Бренд</option>
        {% for brand_item in brands %}
          <option value="{{brand_item.id}}">{{brand_item.name}}</option>
        {% endfor %}
    </select>
  </div>
</div>

<!-- Select Basic -->
<div class="form-group">
  <label class="col-md-4 control-label" for="series"></label>
  <div class="col-md-4">
    <select id="series" name="series" class="form-control">
        <option value="-1">Серия</option>
        {% for series_item in series %}
          <option value="{{series_item.id}}">{{series_item.name}}</option>
        {% endfor %}
    </select>
  </div>
</div>

<!-- Select Basic -->
<div class="form-group">
  <label class="col-md-4 control-label" for="size"></label>
  <div class="col-md-4">
    <select id="size" name="size" class="form-control">
      <option value="-1">Размер</option>
        {% for size_item in sizes %}
          <option value="{{size_item}}">{{size_item}}</option>
        {% endfor %}
    </select>
  </div>
</div>

<!-- Text input-->
<div class="form-group">
  <label class="col-md-4 control-label" for="weight"></label>
  <div class="col-md-4">
  <input id="weight" name="weight" type="text" placeholder="кг" class="form-control input-md">

  </div>
</div>

<!-- Button -->
<div class="form-group">
  <label class="col-md-4 control-label" for="submit"></label>
  <div class="col-md-4">
    <button id="submit" name="submit" class="btn btn-primary">Найти</button>
  </div>
</div>



</form>



</body>

<script src="{% static 'diapers/js/jquery.min.js' %}"  type="text/javascript"></script>

<script>
  $(document).ready(function(){
    $('select#brand').change(function(){
        brand_id = $(this).val();
        brand_name = $(this).text();
        request_url = '/get_series/' + brand_id + '/';
        $.ajax({
            url: request_url,
            success: function(data){
                $('select#series').find('option').remove().end()
                    .append('<option value="-1">Серия</option>')

                $.each(data, function(key, value){
                    $('select#series').append($("<option></option>").text(value).val(key));

                });
            }
        })

        series_id = $('select#series').val()
        request_url = '/get_sizes/' + brand_id + '/' + series_id + '/';
        $.ajax({
            url: request_url,
            success: function(data){
                $('select#size').find('option').remove().end()
                    .append('<option value="-1">Размер</option>')

                $.each(data, function(key, value){
                    $('select#size').append($("<option></option>").text(value).val(value));

                });
            }
        })
    })
    $('select#series').change(function(){
        series_id = $(this).val();
        brand_id = $('select#brand').val();
        request_url = '/get_brands/' + brand_id + '/' + series_id + '/';
        $.ajax({
            url: request_url,
            success: function(data){
                $.each(data, function(key, value){
                    $('select#brand').val(key);
                    brand_id = key;
                    brand_name = $('select#brand').text();
                    series_val = $('select#series').val()

                    request_url = '/get_series/' + brand_id + '/';
                    $.ajax({
                        url: request_url,
                        success: function(data){
                            $('select#series').find('option').remove().end()
                                .append('<option value="-1">Серия</option>')

                            $.each(data, function(key, value){
                                $('select#series').append($("<option></option>").text(value).val(key));

                            $('select#series').val(series_val);
                            });
                        }
                    })

                });
            }
        })



        request_url = '/get_sizes/' + brand_id + '/' + series_id + '/';
        $.ajax({
            url: request_url,
            success: function(data){
                $('select#size').find('option').remove().end()
                    .append('<option value="-1">Размер</option>')

                $.each(data, function(key, value){
                    $('select#size').append($("<option></option>").text(value).val(value));

                });
            }
        })
    })
});
</script>

</html>




